rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // === SuperAdmin ===
    match /{path=**} {
      allow read, write: if request.auth != null
                         && request.auth.token.role == "superAdmin";
    }

    // === Admin (scoped to their company) ===
    match /companies/{companyId}/{path=**} {
      allow read, write: if request.auth != null
                         && request.auth.token.role == "admin"
                         && request.auth.token.companyId == companyId;
    }

    // === Vendor (scoped to their company + own vendor folder) ===
    match /companies/{companyId}/shares/{vendorId}/{path=**} {
      allow read, write: if request.auth != null
                         && request.auth.token.role == "vendor"
                         && request.auth.token.companyId == companyId
                         && request.auth.uid == vendorId;
    }
  }
}
